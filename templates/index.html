<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HitCraft Chat Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-bottom: 2rem;
            background-color: #f8f9fa;
        }
        .header {
            background-color: #343a40;
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }
        .card {
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .nav-tabs .nav-link {
            border-radius: 0.5rem 0.5rem 0 0;
        }
        .nav-tabs .nav-link.active {
            font-weight: bold;
            border-top: 3px solid #0d6efd;
        }
        .analysis-container {
            display: none;
        }
        .api-key-input {
            margin: 1rem 0;
            position: relative;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            margin: 2rem 0;
        }
        .log-container {
            background-color: #212529;
            color: #adb5bd;
            border-radius: 0.5rem;
            padding: 1rem;
            height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }
        .log-entry {
            margin-bottom: 0.3rem;
            white-space: pre-wrap;
            word-break: break-word;
        }
        .log-timestamp {
            color: #6c757d;
            margin-right: 0.5rem;
        }
        .log-info {
            color: #adb5bd;
        }
        .log-warning {
            color: #ffc107;
        }
        .log-error {
            color: #dc3545;
        }
        .log-container-tabs {
            margin-top: 1rem;
        }
        .score-bubble {
            display: inline-block;
            width: 2.5rem;
            height: 2.5rem;
            line-height: 2.5rem;
            text-align: center;
            border-radius: 50%;
            font-weight: bold;
            color: white;
            margin-right: 0.5rem;
        }
        .badge-count {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: bold;
        }
        .progress {
            height: 1.5rem;
            margin: 1rem 0;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
        #logToggleBtn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            border-radius: 30px;
            padding: 10px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        .collapsed-logs {
            height: 150px !important;
            transition: height 0.3s ease;
        }
        .expanded-logs {
            height: 500px !important;
            transition: height 0.3s ease;
        }
        #successMessage {
            display: none;
        }
        .tooltip-inner {
            max-width: 300px;
        }
        .example-container {
            background-color: #f8f9fa;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 0.5rem 0;
            border-left: 4px solid #6c757d;
        }
        .good-example {
            border-left-color: #28a745;
        }
        .poor-example {
            border-left-color: #dc3545;
        }
        .insights-list li {
            margin-bottom: 0.75rem;
        }
        .key-insight {
            background-color: #e9f7fe;
            padding: 1rem;
            border-radius: 0.5rem;
            border-left: 4px solid #17a2b8;
            margin-bottom: 1rem;
        }
        #uploadForm {
            background-color: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .custom-file-input {
            cursor: pointer;
        }
        .mock-notice {
            background-color: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.25rem;
        }
        .error-alert {
            display: none;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>HitCraft Chat Analyzer</h1>
            <p class="lead">Upload chat logs for AI-powered analysis and insights</p>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-lg-8 offset-lg-2">
                <!-- File Upload Form -->
                <div id="uploadForm" class="card">
                    <div class="card-body">
                        <h2 class="card-title mb-4">Upload Chat Logs</h2>
                        <form id="chatLogForm">
                            <div class="mb-3">
                                <label for="fileInput" class="form-label">Select a chat log file (.txt or .rtf)</label>
                                <input type="file" class="form-control" id="fileInput" accept=".txt,.rtf" required>
                                <div class="form-text">Large files will be automatically chunked for processing.</div>
                            </div>
                            
                            <div class="api-key-input">
                                <label for="apiKeyInput" class="form-label">Claude API Key</label>
                                <input type="password" class="form-control" id="apiKeyInput" placeholder="Enter your Claude API key" required>
                                <div class="form-text">Your API key is not stored on our servers. Use "mock" for testing without an API key.</div>
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">Analyze Chats</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Error Alert -->
                <div id="errorAlert" class="alert alert-danger error-alert" role="alert">
                    <h4 class="alert-heading">Error</h4>
                    <p id="errorMessage"></p>
                </div>

                <!-- Success Message -->
                <div id="successMessage" class="alert alert-success" role="alert">
                    <h4 class="alert-heading">File Uploaded Successfully!</h4>
                    <p>Your file has been chunked into <span id="chunkCount">0</span> parts for analysis.</p>
                </div>

                <!-- Processing Logs -->
                <div id="logContainer" class="card mt-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Processing Logs</h5>
                        <button class="btn btn-sm btn-outline-secondary" id="toggleLogsBtn">Expand</button>
                    </div>
                    <div class="card-body p-0">
                        <div id="logsContent" class="log-container"></div>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div id="loadingSpinner" class="loading-spinner">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <h4 class="mt-3">Analyzing conversations...</h4>
                    <div class="progress">
                        <div id="analysisProgress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
                    </div>
                    <p id="progressText">Preparing analysis...</p>
                </div>

                <!-- Analysis Results -->
                <div id="analysisResults" class="analysis-container">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="card-title mb-4">Analysis Results</h2>
                            
                            <!-- Navigation Tabs -->
                            <ul class="nav nav-tabs" id="analysisTab" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab" aria-controls="overview" aria-selected="true">Overview</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="categories-tab" data-bs-toggle="tab" data-bs-target="#categories" type="button" role="tab" aria-controls="categories" aria-selected="false">Categories</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="quality-tab" data-bs-toggle="tab" data-bs-target="#quality" type="button" role="tab" aria-controls="quality" aria-selected="false">Response Quality</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="improvements-tab" data-bs-toggle="tab" data-bs-target="#improvements" type="button" role="tab" aria-controls="improvements" aria-selected="false">Improvements</button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="satisfaction-tab" data-bs-toggle="tab" data-bs-target="#satisfaction" type="button" role="tab" aria-controls="satisfaction" aria-selected="false">User Satisfaction</button>
                                </li>
                            </ul>
                            
                            <!-- Tab Content -->
                            <div class="tab-content p-3" id="analysisTabContent">
                                <!-- Overview Tab -->
                                <div class="tab-pane fade show active" id="overview" role="tabpanel" aria-labelledby="overview-tab">
                                    <h3 class="mb-4">Key Insights</h3>
                                    <div id="keyInsights">
                                        <!-- Key insights will be populated here -->
                                    </div>
                                    
                                    <h3 class="mb-3 mt-4">Top 5 Discussion Topics</h3>
                                    <div id="topDiscussions">
                                        <!-- Top discussions will be populated here -->
                                    </div>
                                    
                                    <div class="row mt-4">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Product Effectiveness</h5>
                                                    <p id="productEffectiveness">Loading...</p>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Overall Response Quality</h5>
                                                    <div class="d-flex align-items-center">
                                                        <div id="qualityScoreBubble" class="score-bubble bg-primary">0</div>
                                                        <span id="qualityScore">Loading...</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Categories Tab -->
                                <div class="tab-pane fade" id="categories" role="tabpanel" aria-labelledby="categories-tab">
                                    <h3 class="mb-4">Conversation Categories</h3>
                                    <p class="text-muted">The main categories of conversations identified in the chat logs:</p>
                                    <div id="categoriesList">
                                        <!-- Categories will be populated here -->
                                    </div>
                                </div>
                                
                                <!-- Response Quality Tab -->
                                <div class="tab-pane fade" id="quality" role="tabpanel" aria-labelledby="quality-tab">
                                    <h3 class="mb-4">Response Quality Analysis</h3>
                                    <div class="mb-4">
                                        <h4>Good Response Examples</h4>
                                        <div id="goodExamples">
                                            <!-- Good examples will be populated here -->
                                        </div>
                                    </div>
                                    
                                    <div class="mb-4">
                                        <h4>Areas for Improvement</h4>
                                        <div id="poorExamples">
                                            <!-- Poor examples will be populated here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Improvements Tab -->
                                <div class="tab-pane fade" id="improvements" role="tabpanel" aria-labelledby="improvements-tab">
                                    <h3 class="mb-4">Suggested Improvements</h3>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <h4>Improvement Areas</h4>
                                            <div id="improvementAreas">
                                                <!-- Improvement areas will be populated here -->
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <h4>Unmet User Needs</h4>
                                            <div id="unmetNeeds">
                                                <!-- Unmet needs will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- User Satisfaction Tab -->
                                <div class="tab-pane fade" id="satisfaction" role="tabpanel" aria-labelledby="satisfaction-tab">
                                    <h3 class="mb-4">User Satisfaction Analysis</h3>
                                    <p id="satisfactionOverview">Loading...</p>
                                    
                                    <div class="row mt-4">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Positive Indicators</h5>
                                                    <ul id="positiveIndicators" class="insights-list">
                                                        <!-- Positive indicators will be populated here -->
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-body">
                                                    <h5 class="card-title">Negative Indicators</h5>
                                                    <ul id="negativeIndicators" class="insights-list">
                                                        <!-- Negative indicators will be populated here -->
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatLogForm = document.getElementById('chatLogForm');
            const fileInput = document.getElementById('fileInput');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const uploadForm = document.getElementById('uploadForm');
            const successMessage = document.getElementById('successMessage');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const analysisResults = document.getElementById('analysisResults');
            const analysisProgress = document.getElementById('analysisProgress');
            const progressText = document.getElementById('progressText');
            const chunkCount = document.getElementById('chunkCount');
            const logsContent = document.getElementById('logsContent');
            const errorAlert = document.getElementById('errorAlert');
            const errorMessage = document.getElementById('errorMessage');
            const toggleLogsBtn = document.getElementById('toggleLogsBtn');
            
            // Toggle logs expand/collapse
            toggleLogsBtn.addEventListener('click', function() {
                const logContainer = document.getElementById('logsContent');
                if (logContainer.classList.contains('expanded-logs')) {
                    logContainer.classList.remove('expanded-logs');
                    logContainer.classList.add('collapsed-logs');
                    toggleLogsBtn.textContent = 'Expand';
                } else {
                    logContainer.classList.remove('collapsed-logs');
                    logContainer.classList.add('expanded-logs');
                    toggleLogsBtn.textContent = 'Collapse';
                }
            });
            
            // Poll for logs periodically
            function fetchLogs() {
                fetch('/logs')
                    .then(response => response.json())
                    .then(logs => {
                        if (logs && logs.length > 0) {
                            logsContent.innerHTML = '';
                            logs.forEach(log => {
                                const logEntry = document.createElement('div');
                                logEntry.className = `log-entry log-${log.level}`;
                                
                                const timestamp = document.createElement('span');
                                timestamp.className = 'log-timestamp';
                                timestamp.textContent = log.timestamp;
                                
                                logEntry.appendChild(timestamp);
                                logEntry.appendChild(document.createTextNode(log.message));
                                logsContent.appendChild(logEntry);
                            });
                            
                            // Auto-scroll to bottom
                            logsContent.scrollTop = logsContent.scrollHeight;
                        }
                    })
                    .catch(error => console.error('Error fetching logs:', error));
            }
            
            // Start polling for logs every 2 seconds
            setInterval(fetchLogs, 2000);
            
            // Form submission handler
            chatLogForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                if (!fileInput.files.length) {
                    showError('Please select a file to upload.');
                    return;
                }
                
                if (!apiKeyInput.value.trim()) {
                    showError('Please enter your Claude API key or use "mock" for testing.');
                    return;
                }
                
                // Hide any previous errors
                errorAlert.style.display = 'none';
                
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                
                // Upload the file first
                uploadFile(formData);
            });
            
            function showError(message) {
                errorMessage.textContent = message;
                errorAlert.style.display = 'block';
                window.scrollTo({ top: errorAlert.offsetTop, behavior: 'smooth' });
            }
            
            function uploadFile(formData) {
                // Show loading state
                uploadForm.style.display = 'none';
                loadingSpinner.style.display = 'block';
                progressText.textContent = 'Uploading and chunking file...';
                
                // Start the progress animation
                progressCounter = 0;
                updateAnalysisProgress();
                
                fetch('/upload', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // Update UI with success message
                    successMessage.style.display = 'block';
                    chunkCount.textContent = data.chunk_count;
                    
                    // Start the analysis
                    progressText.textContent = 'Starting analysis...';
                    analysisProgress.style.width = '25%';
                    
                    return analyzeChunks(data.chunk_count);
                })
                .catch(error => {
                    showError('Upload Error: ' + error.message);
                    uploadForm.style.display = 'block';
                    loadingSpinner.style.display = 'none';
                    successMessage.style.display = 'none';
                });
            }
            
            function analyzeChunks(totalChunks) {
                // Send the Claude API key and trigger analysis
                fetch('/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        api_key: apiKeyInput.value
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(data => {
                            throw new Error(data.error || 'Analysis failed');
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // Update progress to 100%
                    analysisProgress.style.width = '100%';
                    progressText.textContent = 'Analysis complete!';
                    
                    // Hide loading elements and show results
                    setTimeout(() => {
                        loadingSpinner.style.display = 'none';
                        successMessage.style.display = 'none';
                        analysisResults.style.display = 'block';
                        
                        // Scroll to results
                        window.scrollTo({ top: analysisResults.offsetTop, behavior: 'smooth' });
                        
                        // Populate the results
                        displayResults(data.analysis);
                    }, 1000);
                })
                .catch(error => {
                    showError('Analysis Error: ' + error.message);
                    loadingSpinner.style.display = 'none';
                    uploadForm.style.display = 'block';
                });
            }
            
            function displayResults(analysis) {
                console.log("Displaying analysis results:", analysis);
                
                // Key Insights
                const keyInsightsElem = document.getElementById('keyInsights');
                keyInsightsElem.innerHTML = '';
                if (analysis && analysis.key_insights && analysis.key_insights.length) {
                    analysis.key_insights.forEach(insight => {
                        const insightElem = document.createElement('div');
                        insightElem.className = 'key-insight';
                        insightElem.textContent = insight;
                        keyInsightsElem.appendChild(insightElem);
                    });
                } else {
                    keyInsightsElem.innerHTML = '<p class="text-muted">No key insights available.</p>';
                }
                
                // Top Discussions
                const topDiscussionsElem = document.getElementById('topDiscussions');
                topDiscussionsElem.innerHTML = '';
                if (analysis && analysis.top_discussions && analysis.top_discussions.length) {
                    const listElem = document.createElement('ol');
                    listElem.className = 'insights-list';
                    
                    analysis.top_discussions.forEach(topic => {
                        const listItem = document.createElement('li');
                        if (typeof topic === 'object' && topic.topic) {
                            listItem.innerHTML = `<strong>${topic.topic}</strong> ${topic.count ? `(${topic.count} instances)` : ''}`;
                        } else {
                            listItem.textContent = topic;
                        }
                        listElem.appendChild(listItem);
                    });
                    
                    topDiscussionsElem.appendChild(listElem);
                } else {
                    topDiscussionsElem.innerHTML = '<p class="text-muted">No top discussions available.</p>';
                }
                
                // Product Effectiveness
                const productEffectivenessElem = document.getElementById('productEffectiveness');
                if (analysis && analysis.product_effectiveness) {
                    if (typeof analysis.product_effectiveness === 'object') {
                        productEffectivenessElem.textContent = analysis.product_effectiveness.assessment || 'No assessment available.';
                    } else {
                        productEffectivenessElem.textContent = analysis.product_effectiveness;
                    }
                } else {
                    productEffectivenessElem.textContent = 'No product effectiveness assessment available.';
                }
                
                // Quality Score
                const qualityScoreElem = document.getElementById('qualityScore');
                const qualityScoreBubbleElem = document.getElementById('qualityScoreBubble');
                
                if (analysis && analysis.response_quality && analysis.response_quality.average_score) {
                    const score = analysis.response_quality.average_score;
                    qualityScoreElem.textContent = `${score.toFixed(1)} / 10`;
                    qualityScoreBubbleElem.textContent = score.toFixed(1);
                    
                    // Change color based on score
                    if (score >= 8) {
                        qualityScoreBubbleElem.className = 'score-bubble bg-success';
                    } else if (score >= 6) {
                        qualityScoreBubbleElem.className = 'score-bubble bg-primary';
                    } else if (score >= 4) {
                        qualityScoreBubbleElem.className = 'score-bubble bg-warning';
                    } else {
                        qualityScoreBubbleElem.className = 'score-bubble bg-danger';
                    }
                } else {
                    qualityScoreElem.textContent = 'No score available';
                    qualityScoreBubbleElem.textContent = 'N/A';
                    qualityScoreBubbleElem.className = 'score-bubble bg-secondary';
                }
                
                // Categories
                const categoriesListElem = document.getElementById('categoriesList');
                categoriesListElem.innerHTML = '';
                if (analysis && analysis.categories && analysis.categories.length) {
                    const listElem = document.createElement('ul');
                    listElem.className = 'insights-list';
                    
                    analysis.categories.forEach(category => {
                        const listItem = document.createElement('li');
                        listItem.textContent = category;
                        listElem.appendChild(listItem);
                    });
                    
                    categoriesListElem.appendChild(listElem);
                } else {
                    categoriesListElem.innerHTML = '<p class="text-muted">No categories available.</p>';
                }
                
                // Response Quality Examples
                const goodExamplesElem = document.getElementById('goodExamples');
                goodExamplesElem.innerHTML = '';
                if (analysis && analysis.response_quality && analysis.response_quality.good_examples && analysis.response_quality.good_examples.length) {
                    analysis.response_quality.good_examples.forEach(example => {
                        const exampleElem = document.createElement('div');
                        exampleElem.className = 'example-container good-example';
                        exampleElem.textContent = example;
                        goodExamplesElem.appendChild(exampleElem);
                    });
                } else {
                    goodExamplesElem.innerHTML = '<p class="text-muted">No good response examples available.</p>';
                }
                
                const poorExamplesElem = document.getElementById('poorExamples');
                poorExamplesElem.innerHTML = '';
                if (analysis && analysis.response_quality && analysis.response_quality.poor_examples && analysis.response_quality.poor_examples.length) {
                    analysis.response_quality.poor_examples.forEach(example => {
                        const exampleElem = document.createElement('div');
                        exampleElem.className = 'example-container poor-example';
                        exampleElem.textContent = example;
                        poorExamplesElem.appendChild(exampleElem);
                    });
                } else {
                    poorExamplesElem.innerHTML = '<p class="text-muted">No areas for improvement examples available.</p>';
                }
                
                // Improvement Areas
                const improvementAreasElem = document.getElementById('improvementAreas');
                improvementAreasElem.innerHTML = '';
                if (analysis && analysis.improvement_areas && analysis.improvement_areas.length) {
                    const listElem = document.createElement('ul');
                    listElem.className = 'insights-list';
                    
                    analysis.improvement_areas.forEach(area => {
                        const listItem = document.createElement('li');
                        listItem.textContent = area;
                        listElem.appendChild(listItem);
                    });
                    
                    improvementAreasElem.appendChild(listElem);
                } else {
                    improvementAreasElem.innerHTML = '<p class="text-muted">No improvement areas available.</p>';
                }
                
                // Unmet Needs
                const unmetNeedsElem = document.getElementById('unmetNeeds');
                unmetNeedsElem.innerHTML = '';
                if (analysis && analysis.unmet_needs && analysis.unmet_needs.length) {
                    const listElem = document.createElement('ul');
                    listElem.className = 'insights-list';
                    
                    analysis.unmet_needs.forEach(need => {
                        const listItem = document.createElement('li');
                        listItem.textContent = need;
                        listElem.appendChild(listItem);
                    });
                    
                    unmetNeedsElem.appendChild(listElem);
                } else {
                    unmetNeedsElem.innerHTML = '<p class="text-muted">No unmet needs identified.</p>';
                }
                
                // User Satisfaction
                const satisfactionOverviewElem = document.getElementById('satisfactionOverview');
                if (analysis && analysis.user_satisfaction) {
                    if (typeof analysis.user_satisfaction === 'object') {
                        satisfactionOverviewElem.textContent = analysis.user_satisfaction.overall_assessment || 'No assessment available.';
                    } else {
                        satisfactionOverviewElem.textContent = analysis.user_satisfaction;
                    }
                } else {
                    satisfactionOverviewElem.textContent = 'No user satisfaction assessment available.';
                }
                
                // Positive Indicators
                const positiveIndicatorsElem = document.getElementById('positiveIndicators');
                positiveIndicatorsElem.innerHTML = '';
                if (analysis && analysis.user_satisfaction && analysis.user_satisfaction.positive_indicators && analysis.user_satisfaction.positive_indicators.length) {
                    analysis.user_satisfaction.positive_indicators.forEach(indicator => {
                        const listItem = document.createElement('li');
                        listItem.textContent = indicator;
                        positiveIndicatorsElem.appendChild(listItem);
                    });
                } else {
                    positiveIndicatorsElem.innerHTML = '<li class="text-muted">No positive indicators available.</li>';
                }
                
                // Negative Indicators
                const negativeIndicatorsElem = document.getElementById('negativeIndicators');
                negativeIndicatorsElem.innerHTML = '';
                if (analysis && analysis.user_satisfaction && analysis.user_satisfaction.negative_indicators && analysis.user_satisfaction.negative_indicators.length) {
                    analysis.user_satisfaction.negative_indicators.forEach(indicator => {
                        const listItem = document.createElement('li');
                        listItem.textContent = indicator;
                        negativeIndicatorsElem.appendChild(listItem);
                    });
                } else {
                    negativeIndicatorsElem.innerHTML = '<li class="text-muted">No negative indicators available.</li>';
                }
            }
            
            // Initialize analysis progress counter
            let progressCounter = 0;
            function updateAnalysisProgress() {
                if (progressCounter < 90) {
                    progressCounter += 5;
                    analysisProgress.style.width = progressCounter + '%';
                    
                    if (progressCounter < 30) {
                        progressText.textContent = 'Analyzing chat structure...';
                    } else if (progressCounter < 60) {
                        progressText.textContent = 'Identifying user satisfaction metrics...';
                    } else {
                        progressText.textContent = 'Compiling insights...';
                    }
                    
                    setTimeout(updateAnalysisProgress, 1000);
                }
            }
        });
    </script>
</body>
</html>